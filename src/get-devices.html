<script type="text/javascript">
(function () {
    RED.nodes.registerType('get-devices', {
        category: 'eWeLink Cube',
        color: '#4697ff',
        defaults: {
            name: {
                value: '',
            },
            server: {
                value: '',
                required: true,
                type: 'api-server',
            },
            category: {
                value: '',
            },
            device: {
                value: '',
            },
        },
        inputs: 1,
        outputs: 1,
        icon: ' white-globe.svg',
        label() {
            return this.name || 'get device';
        },
        oneditprepare() {
            $('#node-input-name').on('click', () => {
                console.log('-------------------------click')
               var mm = test();
                $('#node-input-category').append(mm)
            });

            $('#node-input-category').on('change',()=>{
                console.log('-------------',$('#node-input-category').val());
                const categoryVal =$('#node-input-category').val();
            })


            function test(){
                var list=[];

                $("#node-input-category").get(0).options.length=0;

                if(!list.length || list.length<1)return '';

                var tempStr='';
                for(var i=0;i<=list.length-1;i++){
                    tempStr+='<option'+' value='+list[i]+'>'+list[i]+'</option>'
                }
                return tempStr;
            }
        }
    });
})();
</script>

<script type="text/html" data-template-name="get-devices">
    <div class="form-row">
        <label for="node-input-name">
            Name
        </label>
        <input type="text" id="node-input-name" placeholder="Name" />
    </div>
    <div class="form-row">
        <label for="node-input-server">
            Server
        </label>
        <input type="text" id="node-input-server" placeholder="server" />
    </div>
    <div class="form-row">
        <label for="node-input-category">
            Category
        </label>
        <select id="node-input-category" placeholder="Category" style="width:70%"></select>
    </div>
    <div class="form-row">
        <label for="node-input-device">
            Device
        </label>
        <select id="node-input-device" placeholder="Device" style="width:70%"></select>
    </div>
</script>
